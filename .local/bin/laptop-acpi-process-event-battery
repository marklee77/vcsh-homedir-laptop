#!/bin/bash
battery=${1:-BAT0}
warn_capacity=8
sleep_capacity=5

scriptname="$(basename $0)"

logfile="${HOME}/.local/var/log/${scriptname}.log"
exec 1>>${logfile}
exec 2>&1

battery_capacity=$(cat /sys/class/power_supply/${battery}/capacity)
battery_status=$(cat /sys/class/power_supply/${battery}/status)

if [ "$battery_status" = "Discharging" ]; then
    if [ $battery_capacity -le $sleep_capacity ]; then
        notify-send --urgency=critical \
            "Hibernating!" \
            "If the computer is not plugged in within the next 30 seconds, hibernation procedures will commence."
        sleep 30
        on_ac_power || laptop-smartsleep
    elif [ $battery_capacity -le $warn_capacity ]; then
        notify-send --urgency=critical \
            "Low Battery Warning!" \
            "The battery charge is critically low. Please connect to AC power."
    fi
fi

exit 0
