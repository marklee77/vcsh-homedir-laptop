#!/bin/bash -x
scriptname="$(basename "${BASH_SOURCE[0]}")"
rundir="${XDG_RUNTIME_DIR:-${HOME}/.local/var/run}/${scriptname}"
mkdir -p "${rundir}"
pidfile="${rundir}/PID"

cleanup() {
    flock -u 200
    rm -f "${pidfile}"
    xset dpms 0 0 0
}

exec 200>"${pidfile}"
if ! flock -n 200 || ! echo "$$" > "${pidfile}"; then
    echo "another instance of the ${scriptname} is currently running..." >&2
    exit 1
fi
trap cleanup EXIT SIGHUP SIGINT SIGQUIT SIGTERM

xset dpms 5 5 5
killall -SIGUSR1 conky
i3lock -c 002b36 -enf
